#!/bin/bash

i=0

music1=$HOME/music/*Netgame*

init_wait=15
debug=false
if [ ! -z $1 ]; then
  if [ $1 = 'debug' ]; then
    debug=true
  else
    echo "invalid arg"
    exit 1
  fi
fi

meditation_time=5

espeak "start" -a 50
if ! $debug; then
  epeak "$meditation_time minute medition starts in 10s"
  sleep 10
  alarm-timer -m 5 --em "Meditation complete"
  espeak "block one starts in $init_wait minutes" -a 50
  alarm-timer -m "$init_wait" --em "" --im ""
fi

while true; do
  if [ $i -ge 4 ]; then
    espeak "block $i over. $((i*90/60)) hours. $(((i*90)%60)) minutes." -s 130 -a 50
    if ! $debug; then
      espeak "are you sleeping" -a 50
      sleep 1
      espeak "Are you sleeping?" -s 150 -a 50
      sleep 3
      espeak "Are you sleeping?" -s 100 -a 50

    fi
  fi
  if [ $i -ge 4 -a $i -le 6  ]; then
    mpv --vo=null $music1 -ss 0 --end 11.5 --volume 50
  fi

  if [ $i = 6 ]; then
    espeak "Wake up"
  fi

  if [ $i -ge 7 ]; then
    mpv --vo=null $music1 -ss 0 --end 11.5 --volume 55
    for i in $(seq 10); do
      espeak "Wake up"
      sleep 6
    done
  fi

  if ! $debug; then
    alarm-timer -m 80 --im "" --em ""
  fi

  i=$(($i + 1))
done
